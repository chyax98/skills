# Scripts 工具集

**设计理念**: 简单、可靠、必要

## 📋 脚本列表

### 1. validate-slides.sh ✅
**用途**: 验证幻灯片是否符合 Slidev 规范

**使用**:
```bash
# 基础验证
./scripts/validate-slides.sh slides.md

# 详细模式 (显示具体行号)
./scripts/validate-slides.sh slides.md --verbose

# 查看帮助
./scripts/validate-slides.sh --help
```

**验证项目** (7大类,14个检查点):
1. 文件格式 (UTF-8 编码、换行符)
2. Frontmatter 配置 (theme, title, fonts)
3. 分页规则 (---前后空行)
4. 代码块规范 (语言标识)
5. Mermaid 图表 (scale 参数)
6. 内容溢出防止 (滚动/缩放)
7. 内容质量 (空白页、标题)

**输出示例**:
```
📋 Slidev 幻灯片规范验证
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

验证文件: slides.md
文件大小: 28K  |  行数: 1292

[1/7] 文件格式检查
✓ 文件使用 UTF-8 编码
✓ 文件使用正确的换行符

[4/7] 代码块规范检查
✗ 发现 6 个无语言标识的代码块
  → 代码块必须指定语言: ```typescript 或 ```text
  → 无语言标识的代码块位置:  (--verbose 模式)
    行 396: 缺少语言标识
    行 445: 缺少语言标识

📊 验证结果
✓ 通过: 13
✗ 失败: 1
```

**退出码**:
- `0`: 所有检查通过
- `1`: 有检查失败

**核心价值**:
- ✅ 为 Agent 提供质量反馈
- ✅ 帮助改进生成策略
- ✅ 发现潜在问题

---

### 2. preview.sh 🚀
**用途**: 快速启动 Slidev 预览

**使用**:
```bash
./scripts/preview.sh slides.md
```

**功能**:
- 检查文件是否存在
- 检查 Slidev 是否安装
- 启动 Slidev 预览服务器
- 自动打开浏览器

**输出示例**:
```
🚀 启动 Slidev 预览...
📄 文件: slides.md

  ➜  Local:   http://localhost:3030/
  ➜  Network: use --host to expose
```

---

## 🔄 推荐工作流

### Agent 生成场景

```bash
# 1. Agent 生成幻灯片
# → 输出到 ~/note-vsc/slides/xxx.md

# 2. 验证规范
./scripts/validate-slides.sh ~/note-vsc/slides/xxx.md --verbose

# 3a. 如果通过 → 启动预览
./scripts/preview.sh ~/note-vsc/slides/xxx.md

# 3b. 如果失败 → Agent 分析错误
# → 改进生成逻辑
# → 重新生成 (而不是修复!)
# → 重新验证
```

**核心原则**: Agent 应该生成正确的内容,而不是依赖脚本修复错误

### 手动编辑场景

```bash
# 1. 编辑 slides.md

# 2. 验证修改
./scripts/validate-slides.sh slides.md --verbose

# 3. 如果有错误 → 查看详细信息 → 手动修复

# 4. 重新验证通过后 → 预览
./scripts/preview.sh slides.md
```

---

## 💡 设计决策

### 为什么只保留2个脚本?

**移除了**:
- ❌ `auto-fix-slides.sh` - 自动修复工具
- ❌ `preview-slides.sh` - 复杂的一键预览

**原因**:

#### 1. 自动修复的问题

**技术问题**:
- 逻辑复杂,容易有 bug
- 难以处理所有边界情况
- 维护成本高

**哲学问题**:
- 掩盖 Agent 生成质量差的问题
- 阻碍 Agent 改进生成策略
- 自动修复不如生成正确

**更好的方案**:
```
Agent 生成错误
  ↓
验证发现问题
  ↓
Agent 分析错误原因
  ↓
改进生成逻辑
  ↓
重新生成 (正确!)
```

#### 2. 复杂预览脚本的问题

**过度设计**:
```bash
# preview-slides.sh 做了太多事
验证 → 修复 → 重新验证 → 预览
```

**实际需求**:
```bash
# 用户/Agent 只需要
启动预览
```

**简单胜过复杂**:
- `preview.sh`: 23 行,简单可靠
- `preview-slides.sh`: 200+ 行,复杂易错

---

## 📊 对比: 之前 vs 现在

| 方面 | 之前 (3个脚本) | 现在 (2个脚本) |
|------|---------------|---------------|
| **复杂度** | 高 (500+ 行) | 低 (< 300 行) |
| **可靠性** | 中 (有 bug) | 高 (简单逻辑) |
| **维护成本** | 高 | 低 |
| **实际价值** | 中 (修复掩盖问题) | 高 (反馈促进改进) |
| **哲学** | 修复错误 | 生成正确 |

---

## 🎯 核心价值

### validate-slides.sh

**价值**: 质量反馈循环

```
Agent 生成
  ↓
验证检查
  ↓
发现问题 (具体行号、类型)
  ↓
Agent 理解错误
  ↓
改进生成策略
  ↓
下次生成更好
```

### preview.sh

**价值**: 简单可靠的预览启动

- 不需要复杂逻辑
- 不会出错
- 专注做好一件事

---

## 🛠️ 未来可能的扩展

如果真的需要,可以考虑添加:

### analyze-slides.sh (质量分析)
```bash
# 统计分析
- 幻灯片数量
- 代码块统计
- 内容密度分析
- 布局使用统计
```

**价值**: 了解幻灯片特征,但不是必需

### batch-validate.sh (批量验证)
```bash
# 批量验证多个文件
./scripts/batch-validate.sh ~/note-vsc/slides/*.md
```

**价值**: 检查历史生成的文件,但频率低

---

## 📝 使用建议

### For Agents

1. **生成时就正确**:
   - 代码块加语言标识
   - 分隔符前后空行
   - Mermaid 加 scale

2. **使用验证反馈**:
   - 看到错误 → 分析原因
   - 改进生成逻辑
   - 重新生成,而不是修复

3. **预览**:
   - 验证通过后用 `preview.sh`
   - 简单可靠

### For Users

1. **手动编辑后验证**:
   - 用 `--verbose` 查看详细错误
   - 手动修复 (更可控)

2. **快速预览**:
   - 直接用 `preview.sh`
   - 或手动: `cd ~/note-vsc/slides && slidev xxx.md --open`

---

## 🔮 设计哲学

**简单性**:
- 少即是多
- 简单的脚本更可靠
- 复杂的逻辑更易出错

**正确性**:
- 生成正确 > 修复错误
- 反馈改进 > 自动修复
- 质量保证 > 问题掩盖

**实用性**:
- 解决真实问题
- 而不是过度设计
- 90% 场景够用就好

---

**更新**: 2025-10-26 (精简版)
