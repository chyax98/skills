# Scripts 规划

## 已实现

### ✅ validate-slides.sh
**用途**: 验证生成的幻灯片是否符合 Slidev 规范

**场景**: 生成完成后,打开预览前

**改进点**:
- [ ] 添加详细的错误位置 (行号)
- [ ] 支持 JSON 输出模式 (方便 Agent 解析)
- [ ] 支持 --fix 自动修复模式
- [ ] 生成验证报告 (HTML/Markdown)

---

## 待实现脚本

### 🔥 优先级 1: 核心工作流

#### 1. auto-fix-slides.sh
**用途**: 自动修复常见的规范问题

**场景**: 验证失败后,尝试自动修复

**功能**:
- 为无语言标识的代码块添加 `text`
- 在缺少空行的 `---` 前后添加空行
- 为 Mermaid 图表添加默认 scale
- 添加缺失的必需 frontmatter 字段

**输出**:
```
🔧 自动修复工具
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[1/4] 修复代码块语言标识
  ✓ 修复 6 个代码块 (添加 text 标识)

[2/4] 修复分页规则
  ✓ 添加 3 处缺失的空行

[3/4] 修复 Mermaid 图表
  ✓ 为 2 个图表添加 scale: 0.75

[4/4] 检查 Frontmatter
  ℹ 所有必需字段已存在

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 修复完成: 11 处问题已修复
💾 已备份原文件: filename.md.bak
```

#### 2. preview-slides.sh
**用途**: 一键预览幻灯片 (集成验证→修复→预览)

**场景**: 生成完成后一键操作

**功能**:
- 运行验证
- 如果失败,尝试自动修复
- 如果修复后验证通过,打开 Slidev
- 如果仍失败,显示详细错误

**输出**:
```
🎬 幻灯片预览工具
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[1/3] 验证规范...
  ❌ 发现 6 个问题

[2/3] 尝试自动修复...
  ✓ 修复完成

[3/3] 重新验证...
  ✓ 所有检查通过

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚀 启动 Slidev...
🌐 预览地址: http://localhost:3030
```

### 🔸 优先级 2: 质量分析

#### 3. analyze-slides.sh
**用途**: 分析幻灯片质量和统计信息

**场景**: 生成完成后,了解幻灯片特征

**功能**:
- 统计幻灯片数量
- 统计代码块、图表、图片数量
- 分析内容密度 (字数/页)
- 检测潜在的溢出页面
- 统计不同布局的使用
- 识别过长/过短的页面

**输出**:
```
📊 幻灯片质量分析
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📄 基本信息
  • 文件: morphllm-mcp-teaching-20251026.md
  • 总页数: 140 页
  • 文件大小: 85.2 KB
  • 主题: seriph

📈 内容统计
  • 代码块: 51 个 (平均 0.36/页)
  • Mermaid 图: 3 个
  • 表格: 8 个
  • 图片: 0 个

📊 内容密度
  • 平均字数: 120 字/页
  • 最长页面: 第 45 页 (380 字)
  • 最短页面: 第 12 页 (15 字)
  • ⚠️  5 页内容较多 (>300字)

🎨 布局使用
  • default: 120 页
  • two-cols: 15 页
  • center: 5 页

⚠️  潜在问题
  • 3 页可能需要启用滚动
  • 2 页代码块较长 (>30行)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💡 建议: 整体质量良好,关注标记的潜在问题页面
```

#### 4. compare-slides.sh
**用途**: 对比修改前后的变化

**场景**: 自动修复后,对比变化

**功能**:
- 显示修改的行数
- 显示具体修改内容
- 统计各类修复的数量

**输出**:
```
🔍 修改对比报告
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📝 修改统计
  • 总修改: 11 处
  • 新增行: 15 行
  • 修改行: 6 行
  • 删除行: 0 行

📊 修复类型
  [代码块] 6 处 - 添加语言标识
  [分页符] 3 处 - 添加空行
  [图表] 2 处 - 添加 scale 参数

🔍 详细变化 (前5处)

  第 396 行: 添加语言标识
  - ```
  + ```text
    https://morphllm.com/...

  第 450 行: 添加空行
    内容
  +
    ---

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💾 查看完整差异: git diff filename.md.bak filename.md
```

### 🔹 优先级 3: 开发辅助

#### 5. watch-slides.sh
**用途**: 监听文件变化,自动重新验证

**场景**: 开发调试时,实时反馈

**功能**:
- 监听 Markdown 文件变化
- 自动运行验证
- 显示验证结果

#### 6. batch-validate.sh
**用途**: 批量验证目录下所有幻灯片

**场景**: 检查历史生成的所有幻灯片

**功能**:
- 扫描目录下所有 .md 文件
- 批量运行验证
- 生成汇总报告

**输出**:
```
📦 批量验证报告
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

扫描目录: ~/note-vsc/slides/
找到文件: 12 个

验证结果:
  ✓ 8 个通过
  ❌ 3 个失败
  ⚠️  1 个有警告

失败文件:
  1. fastapi-teaching.md (2 个错误)
  2. react-hooks.md (5 个错误)
  3. golang-concurrency.md (1 个错误)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💡 运行 ./batch-fix.sh 批量修复
```

#### 7. export-slides.sh
**用途**: 导出幻灯片为 PDF/HTML

**场景**: 需要分享或归档

**功能**:
- 导出为 PDF
- 导出为静态 HTML
- 支持带/不带备注

### 🔷 优先级 4: 模板工具

#### 8. create-template.sh
**用途**: 快速创建新场景模板

**场景**: 添加新模板时

**功能**:
- 交互式创建模板文件
- 自动更新 SKILL.md
- 自动更新 README.md

#### 9. test-template.sh
**用途**: 测试模板生成效果

**场景**: 验证模板是否正常工作

---

## 实现优先级

### 立即实现 (本次会话)
1. ✅ validate-slides.sh (已完成,需增强)
2. 🔧 auto-fix-slides.sh (自动修复)
3. 🎬 preview-slides.sh (一键预览)

### 下次实现
4. 📊 analyze-slides.sh (质量分析)
5. 🔍 compare-slides.sh (对比报告)

### 按需实现
6-9. 其他辅助工具

---

## 脚本设计原则

### 1. 输出规范
- 使用统一的标题格式: `🔧 工具名称`
- 使用分隔线: `━━━━━━` (全角)
- 使用进度标识: `[1/3]`, `[2/3]`
- 使用状态图标: `✓`, `✗`, `⚠`, `ℹ`, `→`
- 使用颜色编码: 绿色(成功), 红色(失败), 黄色(警告), 蓝色(信息)

### 2. 错误处理
- 检查文件是否存在
- 检查依赖工具是否安装
- 提供清晰的错误信息
- 支持 --debug 模式

### 3. 用户体验
- 提供 --help 帮助信息
- 支持 --dry-run 预演模式
- 支持 --verbose 详细输出
- 提供进度反馈

### 4. 可组合性
- 脚本之间可以互相调用
- 支持管道操作
- 返回标准退出码

---

## 技术栈选择

### Bash (当前)
**优点**:
- 无需依赖
- 快速执行
- 适合文件操作

**缺点**:
- 复杂逻辑难写
- 错误处理繁琐
- 不支持复杂数据结构

### Python (推荐迁移)
**优点**:
- 强大的文本处理
- 丰富的库 (rich, click)
- 良好的错误处理
- 支持复杂逻辑

**缺点**:
- 需要 Python 环境
- 稍慢 (对于这些任务可忽略)

### Node.js (备选)
**优点**:
- 与 Slidev 生态一致
- 可以复用 Slidev 的解析器
- TypeScript 类型支持

**缺点**:
- 需要 Node.js 环境
- 启动较慢

---

## 建议

### 当前阶段
1. 增强 `validate-slides.sh`:
   - 添加行号定位
   - 添加 JSON 输出模式
   - 添加 --summary 简洁模式

2. 实现 `auto-fix-slides.sh`:
   - 自动修复常见问题
   - 备份原文件
   - 显示修复详情

3. 实现 `preview-slides.sh`:
   - 集成验证→修复→预览流程
   - 一键启动

### 未来考虑
- 使用 Python 重写核心脚本
- 使用 `rich` 库增强输出
- 支持配置文件自定义规则
