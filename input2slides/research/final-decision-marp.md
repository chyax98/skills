# doc2slides 最终技术方案: Marp

## 决策日期
2025-10-23

## 最终选择
**Marp CLI** (https://marp.app/)

## 决策理由

### ✅ 实测验证通过
1. **HTML 导出成功** - 108KB 自包含文件,可直接 `open` 打开
2. **PPTX 导出成功** - 564KB PowerPoint 文件,完美兼容
3. **无复杂依赖** - 全局安装即可使用,无需项目级配置
4. **轻量级** - 安装包 151 个依赖,远小于 Slidev (617+ 个)

### ❌ Slidev 遇到的问题
1. **CORS 限制** - HTML 导出需要 HTTP 服务器才能打开
2. **依赖复杂** - 需要项目级安装主题和依赖
3. **导出困难** - PDF/PPTX 需要额外安装 playwright-chromium
4. **重量级** - 完整的 Vue 3 应用,不适合简单场景

## Marp 技术特性

### 核心优势
- ✅ **CLI 简单**: `marp slides.md -o output.html/pptx`
- ✅ **自包含 HTML**: 所有资源内联,无外部依赖
- ✅ **原生 PPTX**: 直接生成 PowerPoint 格式
- ✅ **主题系统**: 纯 CSS 定制,简单直观
- ✅ **即开即用**: 全局安装,任何目录都能使用

### Markdown 语法

```markdown
---
marp: true
theme: default
paginate: true
---

# 标题页

内容

---

## 第二页

- 列表项1
- 列表项2
```

### 导出命令

```bash
# 导出 HTML (自包含)
marp --no-stdin slides.md -o slides.html

# 导出 PPTX
marp --no-stdin slides.md -o slides.pptx --allow-local-files

# 导出 PDF (需要 Chrome/Chromium)
marp --no-stdin slides.md -o slides.pdf

# 实时预览
marp --no-stdin slides.md --server
```

## 实施路线

### Phase 1: 基础集成 ✅
- [x] 全局安装 Marp CLI
- [x] 验证 HTML 导出
- [x] 验证 PPTX 导出
- [x] 创建测试样例

### Phase 2: 自定义主题 (进行中)
- [ ] 创建 doc2slides-midnight.css
- [ ] 创建 doc2slides-warm.css
- [ ] 创建 doc2slides-focus.css
- [ ] 创建 doc2slides-vibrant.css

### Phase 3: Skill 适配
- [ ] 更新 doc2slides skill 输出 Marp 格式
- [ ] 添加主题选择参数
- [ ] 实现分段生成策略

### Phase 4: 工具封装
- [ ] 创建 `doc2slides` CLI 包装器
- [ ] 简化常用命令
- [ ] 添加批量转换功能

## Marp 主题开发规范

### 主题文件结构

```css
/* doc2slides-midnight.css */

/* @theme midnight */
/* @author Claude */
/* @version 1.0.0 */

@import 'default';

:root {
  --color-background: #1a1a2e;
  --color-foreground: #eee;
  --color-highlight: #e94560;
}

section {
  background: var(--color-background);
  color: var(--color-foreground);
  font-size: 20px;
  padding: 30px 40px;
}

h1 {
  color: var(--color-highlight);
  font-size: 2.2em;
}

code {
  background: rgba(255,255,255,0.1);
}

pre {
  background: rgba(0,0,0,0.3);
  font-size: 0.8em;
}
```

### 使用自定义主题

```bash
# 指定主题文件
marp --no-stdin --theme doc2slides-midnight.css slides.md -o output.html
```

## doc2slides Skill 输出格式

### Markdown 模板

```markdown
---
marp: true
theme: default
paginate: true
header: '文档标题'
footer: 'Generated by doc2slides @ {date}'
---

<!-- _class: lead -->
# 主标题
## 副标题

---

## 内容页

正文内容

---

<!-- _class: lead -->
# 章节分隔

---
```

### 内置 class 类型

| Class | 用途 | 效果 |
|-------|------|------|
| `lead` | 封面/章节页 | 居中显示 |
| `invert` | 反色 | 深色背景 |
| 无 | 默认内容页 | 左对齐 |

## 与用户的交互流程

### 用户使用 doc2slides skill

```
用户: "把这个 TypeScript 教程转成 PPT"

Claude (doc2slides skill):
1. 分析文档内容
2. 生成 slides.md (Marp 格式)
3. 保存到指定路径

输出: "/path/to/slides.md 已生成"
```

### 用户渲染 PPT

```bash
# 方式1: 使用 Marp CLI (直接)
marp --no-stdin slides.md -o slides.html
open slides.html

# 方式2: 使用 doc2slides CLI (封装, 未来)
doc2slides render slides.md --format html --theme midnight
doc2slides render slides.md --format pptx --theme warm
```

## 优势总结

### vs Slidev
- ✅ **更轻量**: 150 vs 617+ 依赖
- ✅ **更简单**: 无需项目配置
- ✅ **HTML 可用**: 直接打开,无 CORS 问题
- ✅ **PPTX 原生**: 无需 playwright

### vs reveal-md
- ✅ **维护活跃**: Marp 持续更新
- ✅ **PPTX 支持**: reveal-md 不支持
- ✅ **CLI 更强**: 更多导出选项

### vs mdx-deck
- ✅ **维护状态**: mdx-deck 已停更
- ✅ **无框架依赖**: 不需要 React
- ✅ **更简单**: 纯 Markdown

## 风险和缓解

### 潜在问题
1. **主题定制限制**: 仅支持 CSS,不能用 Vue/React 组件
   - 缓解: 对于 doc2slides 用例,CSS 已足够

2. **复杂交互**: 不支持动态内容
   - 缓解: 教学类 PPT 主要是静态内容

3. **PDF 导出**: 需要安装 Chrome/Chromium
   - 缓解: 优先使用 HTML 和 PPTX,PDF 可选

## 下一步行动

1. ✅ 验证 Marp 基本功能
2. ⏭️  开发 4 个自定义主题
3. ⏭️  更新 doc2slides skill 输出格式
4. ⏭️  创建 CLI 包装器
5. ⏭️  编写用户文档

## 总结

经过实际测试,**Marp 是 doc2slides 项目的最佳选择**:
- 轻量级、简单、可靠
- HTML 和 PPTX 导出完美
- 全局安装,即开即用
- 主题系统简单但够用

Slidev 虽然功能强大,但对于 doc2slides 的场景来说过于复杂,且 HTML 导出有 CORS 限制。Marp 的简洁性和实用性更符合项目需求。
