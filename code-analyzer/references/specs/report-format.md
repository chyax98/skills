# 测试分析报告格式规范

## 输出格式

**Markdown** - 面向测试工程师,易读易用。

## 文件命名

```
{分支名}-{年月日}-{时分秒}.md
```

示例:

- `feature-login-20251026-153022.md`
- `bugfix-payment-20251027-100030.md`

## 保存路径

报告保存在**被分析项目的根目录**下:

```
{被分析项目根目录}/analysis-reports/{需求名称}/{文件名}.md
```

**路径说明**:
- `{被分析项目根目录}`: 实际被分析的项目目录,如 `/home/user/myproject/`
- **不是** code-analyzer skill 本身的目录

示例:

```bash
# 被分析的项目路径
/home/user/myproject/

# 报告保存位置
/home/user/myproject/analysis-reports/用户登录优化/feature-login-20251026-153022.md
/home/user/myproject/analysis-reports/支付流程优化/feature-payment-20251027-100030.md
```

## 报告结构

### 必需部分

1. 标题: `# 测试分析报告: {需求名称}`
2. 基本信息: `## 📋 基本信息`
3. 缺陷清单: `## 🔴 发现缺陷`
4. 影响范围: `## 📊 影响范围分析`
5. 风险评估: `## ⚠️ 风险评估`
6. 测试重点: `## 💡 测试重点建议`

### 可选部分

- 需求实现情况: `## 🎯 需求实现情况` (如果用户提供了需求文档)

## 完整模板

```markdown
# 测试分析报告: {需求名称}

## 📋 基本信息

- **需求名称**: {需求名称}
- **分析分支**: {分支名}
- **对比基准**: {基准分支}
- **提交数量**: {N} 次
- **变更文件**: {M} 个 (新增 X 个, 修改 Y 个, 删除 Z 个)
- **变更行数**: +{additions} / -{deletions}
- **分析时间**: {YYYY-MM-DD HH:mm:ss}
- **技术栈**: {techstack}

---

## 🔴 发现缺陷 ({total}个)

### 🔴 Blocker - 阻断级 ({count}个)

#### {序号}. {缺陷类型}

- **文件**: `{文件路径:行号}`
- **代码**:
  ```{language}
  {代码片段}
  ```
- **问题**: {问题描述}
- **影响**: {影响说明}
- **修复建议**: {修复方案}
  ```{language}
  {示例代码}
  ```
- **参考**: {OWASP/CWE 编号}

### 🟠 Critical - 严重级 ({count}个)

...

### 🟡 Major - 重要级 ({count}个)

...

### 🟢 Minor - 次要级 ({count}个)

...

---

## 🎯 需求实现情况

### ✅ 已实现 ({count}/{total} - {percentage}%)

{序号}. **{需求描述}**
   - {实现证据 1}
   - {实现证据 2}
   - ...

### ❌ 未实现 ({count}/{total} - {percentage}%)

{序号}. **{需求描述}**
   - 未找到相关代码实现
   - 风险: {影响说明}

### ⚠️ 多余实现 (需确认)

{序号}. **{功能描述}**
   - {代码位置}
   - 需求文档中未提及,需与产品确认是否必要

---

## 📊 影响范围分析

### 直接影响模块 ({count}个)

{序号}. **{模块名}**
   - 变更类型: {新增/修改/删除}
   - 影响说明: {描述}

### 间接影响模块 ({count}个)

{序号}. **{模块名}**
   - 调用路径: `{调用链}`
   - 影响原因: {描述}

### 回归测试范围建议

#### 🔴 必须测试 (Priority 1)

{序号}. **{模块/功能名}**
   - {测试点 1}
   - {测试点 2}
   - ...

#### 🟡 建议测试 (Priority 2)

{序号}. **{模块/功能名}**
   - {测试点 1}
   - ...

#### 🟢 可选测试 (Priority 3)

{序号}. **{模块/功能名}**
   - {测试点 1}
   - ...

---

## ⚠️ 风险评估

### 综合风险等级: {风险图标} {风险等级}

### 风险来源

1. **缺陷风险: {风险图标} {风险等级} ({score}分)**
   - {Blocker 数量}个 Blocker 级缺陷 ({具体缺陷})
   - {Critical 数量}个 Critical 级缺陷 ({具体缺陷})
   - 缺陷分数: {计算公式} = {score}分

2. **影响范围风险: {风险图标} {风险等级}**
   - 直接影响 {N} 个模块
   - 间接影响 {M} 个模块
   - {核心模块}变更,影响面{大/中/小}

3. **需求覆盖风险: {风险图标} {风险等级}**
   - 需求覆盖率: {percentage}% ({已实现}/{总数})
   - {未实现需求描述}
   - {多余实现说明}

### 测试建议

#### 🔴 优先级 1 - 立即处理

{序号}. **{建议标题}**
   - {具体建议内容}

#### 🟠 优先级 2 - 提测前处理

{序号}. **{建议标题}**
   - {具体建议内容}

#### 🟡 优先级 3 - 计划处理

{序号}. **{建议标题}**
   - {具体建议内容}

---

## 💡 测试重点建议

### 安全测试

- **{测试类型}**: {测试内容}
- **{测试类型}**: {测试内容}
- ...

### 性能测试

- **{测试类型}**: {测试内容}
- ...

### 功能测试

- **{测试类型}**: {测试内容}
- ...

### 兼容性测试

- **{测试类型}**: {测试内容}
- ...

---

**报告生成**: code-analyzer v{version}
**生成时间**: {YYYY-MM-DD HH:mm:ss}
```

## 风险图标

- 🔴: 极高风险 / 阻断级 (Blocker)
- 🟠: 高风险 / 严重级 (Critical)
- 🟡: 中风险 / 重要级 (Major)
- 🟢: 低风险 / 次要级 (Minor)

## 风险等级

### 缺陷风险

```
风险分数 = Blocker×10 + Critical×5 + Major×2 + Minor×1

0-5分: 🟢 低风险
6-15分: 🟡 中风险
16-30分: 🟠 高风险
30分以上: 🔴 极高风险
```

### 影响范围风险

```
直接影响模块 ≤ 3个: 🟢 低风险
直接影响模块 4-6个: 🟡 中风险
直接影响模块 > 6个: 🔴 高风险
```

### 需求覆盖风险

```
需求覆盖率 ≥ 90%: 🟢 低风险
需求覆盖率 70-90%: 🟡 中风险
需求覆盖率 < 70%: 🔴 高风险
```

### 综合风险

取三者中最高风险等级。

## 代码块格式

### Java

````markdown
```java
@Query("SELECT * FROM user WHERE name = :name")
User findByName(@Param("name") String name);
```
````

### SQL

````markdown
```sql
SELECT * FROM user WHERE id = 1;
```
````

### Bash

````markdown
```bash
git diff HEAD~3..HEAD
```
````

## 表格格式

### 基本信息表

```markdown
| 字段 | 值 |
|------|-----|
| 需求名称 | 用户登录优化 |
| 分析分支 | feature/login |
| 提交数量 | 3 次 |
```

### 缺陷统计表

```markdown
| 严重度 | 数量 | 占比 |
|--------|------|------|
| Blocker | 2 | 40% |
| Critical | 1 | 20% |
| Major | 2 | 40% |
| Minor | 0 | 0% |
| **总计** | **5** | **100%** |
```

## 注意事项

1. **语言风格**: 面向测试工程师,避免过于技术化
2. **可操作性**: 每个建议都应该是可执行的
3. **优先级明确**: 清晰标注优先级
4. **证据充分**: 提供代码位置、调用链等证据
5. **格式一致**: 严格遵循模板格式

## 示例报告

完整示例见 SKILL.md 中的"报告示例"部分。

---

**版本**: 1.0.0
**创建**: 2025-10-27
